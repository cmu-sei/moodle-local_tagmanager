{"version":3,"file":"exportmenu.min.js","sources":["../src/exportmenu.js"],"sourcesContent":["define(['jquery', 'core/templates'], function($, Templates) {\n    return {\n        init: function() {\n            $(document).ready(function() {\n                // Collections table case: add Export per row.\n                $('.tag-collections-table tbody tr').each(function() {\n                    var row = $(this);\n\n                    // Skip if export already present.\n                    if (row.find('.export-collection').length) {\n                        return;\n                    }\n\n                    // Look at the \"lastcol\" cell where actions live.\n                    var actionCell = row.find('td.c4.lastcol');\n                    if (!actionCell.length) {\n                        return;\n                    }\n\n                    // Extract tc from the link in the name column (safer for both default & others).\n                    var tcLink = row.find('td.c0 a[href*=\"manage.php?tc=\"]');\n                    if (!tcLink.length) {\n                        return;\n                    }\n                    var url = new URL(tcLink.attr('href'), window.location.origin);\n                    var tc = url.searchParams.get('tc');\n                    if (!tc) {\n                        return;\n                    }\n\n                    var sesskey = M.cfg.sesskey;\n                    var exportUrl = M.cfg.wwwroot + '/local/tagmanager/export.php?tc=' + tc + '&sesskey=' + sesskey;\n\n                    // Render and insert Export icon at the end of the action cell.\n                    Templates.render('local_tagmanager/export_action', {\n                        exporturl: exportUrl\n                    }).done(function(html, js) {\n                        actionCell.append(html); // for default this will be the only icon\n                        Templates.runTemplateJS(js);\n                    }).fail(function(ex) {\n                        console.error('Failed to render export link', ex);\n                    });\n                });\n            });\n        }\n    };\n});\n"],"names":["define","$","Templates","init","document","ready","each","row","this","find","length","actionCell","tcLink","tc","URL","attr","window","location","origin","searchParams","get","sesskey","M","cfg","exportUrl","wwwroot","render","exporturl","done","html","js","append","runTemplateJS","fail","ex","console","error"],"mappings":"AAAAA,qCAAO,CAAC,SAAU,mBAAmB,SAASC,EAAGC,iBACtC,CACHC,KAAM,WACFF,EAAEG,UAAUC,OAAM,WAEdJ,EAAE,mCAAmCK,MAAK,eAClCC,IAAMN,EAAEO,UAGRD,IAAIE,KAAK,sBAAsBC,YAK/BC,WAAaJ,IAAIE,KAAK,oBACrBE,WAAWD,YAKZE,OAASL,IAAIE,KAAK,sCACjBG,OAAOF,YAIRG,GADM,IAAIC,IAAIF,OAAOG,KAAK,QAASC,OAAOC,SAASC,QAC1CC,aAAaC,IAAI,SACzBP,QAIDQ,QAAUC,EAAEC,IAAIF,QAChBG,UAAYF,EAAEC,IAAIE,QAAU,mCAAqCZ,GAAK,YAAcQ,QAGxFnB,UAAUwB,OAAO,iCAAkC,CAC/CC,UAAWH,YACZI,MAAK,SAASC,KAAMC,IACnBnB,WAAWoB,OAAOF,MAClB3B,UAAU8B,cAAcF,OACzBG,MAAK,SAASC,IACbC,QAAQC,MAAM,+BAAgCF"}