{"version":3,"file":"managecollection.min.js","sources":["../src/managecollection.js"],"sourcesContent":["define(['jquery', 'core/str', 'core/notification'], function($, Str, Notification) {\n\n    function getSelectedIds() {\n        const ids = $('[data-region=\"reportbuilder-table\"] input[name=\"report-select-row[]\"][data-toggle=\"slave\"]:checked')\n            .map(function() { return ($(this).val() || '').toString().trim(); })\n            .get()\n            .filter(v => /^\\d+$/.test(v));\n        return [...new Set(ids)];\n    }\n\n    function initExportSelected(tc) {\n        const $combine = $('#tag-management-combine');\n        if (!$combine.length) return;\n\n        const $form = $combine.closest('form');\n        if (!$form.length) return;\n\n        if ($form.find('.local-tagmanager-exportselected').length) return;\n\n        const $btn = $('<button/>', {\n            type: 'button',\n            class: 'btn btn-secondary local-tagmanager-exportselected',\n            text: 'Export selected'\n        });\n\n        $btn.insertAfter($combine);\n\n        let noneMsg = 'No tags selected';\n        Str.get_strings([\n            {key: 'exportselected', component: 'local_tagmanager'},\n            {key: 'exportselectednone', component: 'local_tagmanager'}\n        ]).then(function(strings) {\n            $btn.text(strings[0]);\n            noneMsg = strings[1];\n        });\n\n        $btn.on('click', function(e) {\n            e.preventDefault();\n\n            const ids = getSelectedIds();\n            if (!ids.length) {\n                Notification.addNotification({message: noneMsg, type: 'info'});\n                return;\n            }\n\n            const url = M.cfg.wwwroot\n                + '/local/tagmanager/export.php'\n                + '?tc=' + encodeURIComponent(tc)\n                + '&tagids=' + encodeURIComponent(ids.join(','))\n                + '&sesskey=' + encodeURIComponent(M.cfg.sesskey);\n\n            window.location.href = url;\n        });\n    }\n\n    function initImportStandard(tc) {\n        const $row = $('.d-flex.justify-content-between.mb-2').first();\n        if (!$row.length) return;\n\n        const $addStandard = $row.find('button[data-action=\"addstandardtag\"]').first();\n        if (!$addStandard.length) return;\n\n        if ($row.find('.local-tagmanager-importstandard').length) return;\n\n        // Right-side actions container.\n        let $right = $row.find('.local-tagmanager-header-actions');\n        if (!$right.length) {\n            $right = $('<div/>', {\n                class: 'd-flex align-items-center gap-2 local-tagmanager-header-actions'\n            });\n\n            $addStandard.detach().appendTo($right);\n            $row.append($right);\n            $row.addClass('align-items-center');\n        }\n\n        const $btn = $('<button/>', {\n            type: 'button',\n            class: 'btn btn-primary local-tagmanager-importstandard',\n            html: '<i class=\"icon fa fa-plus fa-fw\" aria-hidden=\"true\"></i> Import standard tags'\n        });\n\n        $right.append($btn);\n\n        $btn.on('click', function() {\n            window.location.href =\n                M.cfg.wwwroot + '/local/tagmanager/import.php?tc=' + encodeURIComponent(tc);\n        });\n    }\n\n    return {\n        init: function(tc) {\n            $(function() {\n                if (!tc) return;\n                initExportSelected(tc);\n                initImportStandard(tc);\n            });\n        }\n    };\n});\n"],"names":["define","$","Str","Notification","initExportSelected","tc","$combine","length","$form","closest","find","$btn","type","class","text","insertAfter","noneMsg","get_strings","key","component","then","strings","on","e","preventDefault","ids","map","this","val","toString","trim","get","filter","v","test","Set","getSelectedIds","addNotification","message","url","M","cfg","wwwroot","encodeURIComponent","join","sesskey","window","location","href","init","$row","first","$addStandard","$right","detach","appendTo","append","addClass","html","initImportStandard"],"mappings":"AAAAA,2CAAO,CAAC,SAAU,WAAY,sBAAsB,SAASC,EAAGC,IAAKC,uBAUxDC,mBAAmBC,UAClBC,SAAWL,EAAE,+BACdK,SAASC,OAAQ,aAEhBC,MAAQF,SAASG,QAAQ,YAC1BD,MAAMD,OAAQ,UAEfC,MAAME,KAAK,oCAAoCH,OAAQ,aAErDI,KAAOV,EAAE,YAAa,CACxBW,KAAM,SACNC,MAAO,oDACPC,KAAM,oBAGVH,KAAKI,YAAYT,cAEbU,QAAU,mBACdd,IAAIe,YAAY,CACZ,CAACC,IAAK,iBAAkBC,UAAW,oBACnC,CAACD,IAAK,qBAAsBC,UAAW,sBACxCC,MAAK,SAASC,SACbV,KAAKG,KAAKO,QAAQ,IAClBL,QAAUK,QAAQ,MAGtBV,KAAKW,GAAG,SAAS,SAASC,GACtBA,EAAEC,uBAEIC,qBApCJA,IAAMxB,EAAE,sGACTyB,KAAI,kBAAqBzB,EAAE0B,MAAMC,OAAS,IAAIC,WAAWC,UACzDC,MACAC,QAAOC,GAAK,QAAQC,KAAKD,WACvB,IAAI,IAAIE,IAAIV,MAgCHW,OACPX,IAAIlB,mBACLJ,aAAakC,gBAAgB,CAACC,QAAStB,QAASJ,KAAM,eAIpD2B,IAAMC,EAAEC,IAAIC,QAANF,mCAEGG,mBAAmBtC,IAC5B,WAAasC,mBAAmBlB,IAAImB,KAAK,MACzC,YAAcD,mBAAmBH,EAAEC,IAAII,SAE7CC,OAAOC,SAASC,KAAOT,aAuCxB,CACHU,KAAM,SAAS5C,IACXJ,GAAE,WACOI,KACLD,mBAAmBC,aAvCHA,UAClB6C,KAAOjD,EAAE,wCAAwCkD,YAClDD,KAAK3C,OAAQ,aAEZ6C,aAAeF,KAAKxC,KAAK,wCAAwCyC,YAClEC,aAAa7C,OAAQ,UAEtB2C,KAAKxC,KAAK,oCAAoCH,OAAQ,WAGtD8C,OAASH,KAAKxC,KAAK,oCAClB2C,OAAO9C,SACR8C,OAASpD,EAAE,SAAU,CACjBY,MAAO,oEAGXuC,aAAaE,SAASC,SAASF,QAC/BH,KAAKM,OAAOH,QACZH,KAAKO,SAAS,6BAGZ9C,KAAOV,EAAE,YAAa,CACxBW,KAAM,SACNC,MAAO,kDACP6C,KAAM,kFAGVL,OAAOG,OAAO7C,MAEdA,KAAKW,GAAG,SAAS,WACbwB,OAAOC,SAASC,KACZR,EAAEC,IAAIC,QAAU,mCAAqCC,mBAAmBtC,OASxEsD,CAAmBtD"}